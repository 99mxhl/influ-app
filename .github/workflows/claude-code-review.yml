# Claude Code Review
# Automatically reviews PRs for bugs, security issues, and code quality
#
# Prerequisites:
# 1. Install GitHub App: /install-github-app in Claude Code terminal
# 2. Add ANTHROPIC_API_KEY to repository secrets:
#    Settings → Secrets and variables → Actions → New repository secret

name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize, ready_for_review, reopened]

jobs:
  review:
    # Skip draft PRs
    if: github.event.pull_request.draft == false
    runs-on: ubuntu-latest

    permissions:
      contents: read
      pull-requests: write
      id-token: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Claude Code Review
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            Review this PR for an influencer marketing platform.

            Tech stack:
            - Backend: Spring Boot 3.x (Java 21), PostgreSQL, Flyway
            - Mobile: Flutter 3.x with Riverpod

            Check for:
            1. Bugs and logic errors
            2. Security vulnerabilities (OWASP top 10, SQL injection, XSS)
            3. Code style issues (Google style for Java, Effective Dart for Flutter)
            4. Architecture concerns
            5. Missing error handling
            6. Performance issues

            Be concise. Focus on actionable feedback.
            Post your findings as a PR review comment.
          claude_args: "--max-turns 10 --model claude-opus-4-5-20251101"
