# Claude Code Review
# Automatically reviews PRs for bugs, security issues, and code quality
#
# Prerequisites:
# 1. Install GitHub App: /install-github-app in Claude Code terminal
# 2. Add ANTHROPIC_API_KEY to repository secrets:
#    Settings → Secrets and variables → Actions → New repository secret

name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize, ready_for_review, reopened]

jobs:
  review:
    # Skip draft PRs
    if: github.event.pull_request.draft == false
    runs-on: ubuntu-latest

    permissions:
      contents: read
      pull-requests: write
      id-token: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Claude Code Review
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            Review this pull request. Use `gh pr diff` to see the changes, then read any files you need for context.

            Tech stack: Spring Boot 3.x (Java 21), PostgreSQL, Flutter 3.x with Riverpod.

            Check for bugs, security issues (OWASP top 10), code style (Google style for Java, Effective Dart for Flutter), and architecture concerns.

            When done, post a concise review comment using `gh pr review` with your findings.
            If no issues found, approve the PR. If issues found, request changes.
          claude_args: "--max-turns 20 --model claude-opus-4-5-20251101"
